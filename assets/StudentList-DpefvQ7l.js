import{_ as L,r as u,c as z,i as R,b as s,o as n,e as t,f as c,t as o,x as _,g as v,v as y,z as N,F as h,k as g,n as T,w as V,j}from"./index-jU6pvMoE.js";import{a as p}from"./index-B9ygI19o.js";const K={class:"page-container"},G={class:"page-header"},H={class:"header-left"},J={class:"count-badge"},O={class:"header-actions"},Q={class:"filter-bar"},W=["value"],X={class:"table-wrapper"},Y={class:"data-table"},Z={class:"name-cell"},tt={class:"action-cell"},et=["onClick"],at=["onClick"],lt={key:0},st={class:"modal-box"},nt={class:"form-row"},ot={class:"form-group"},dt={class:"form-group"},ut={class:"form-group"},it=["value"],rt={class:"form-row"},vt={class:"form-group"},ct={class:"form-group"},pt={class:"modal-box"},mt={class:"upload-area"},bt={key:0,class:"import-preview"},ft={class:"preview-list"},yt={key:0,class:"preview-more"},ht={class:"modal-actions"},gt=["disabled"],kt={class:"modal-box small"},It={class:"transfer-info"},wt=["value"],xt={__name:"StudentList",setup(Ct){const S=u([]),k=u([]),m=u(""),I=u(""),w=u(""),P=u(!1),U=u(!1),M=u(!1),d=u({name:"",studentId:"",classId:"",parentName:"",parentPhone:""}),i=u([]),x=u(null),C=u(""),$=z(()=>S.value.filter(l=>{const e=!m.value||l.name.includes(m.value)||l.studentId.includes(m.value),a=!I.value||l.classId===I.value,f=!w.value||l.status===w.value;return e&&a&&f})),b=async()=>{try{const[l,e]=await Promise.all([p.get("/api/admin/students"),p.get("/api/admin/classes")]);l.data.code===200&&(S.value=l.data.data),e.data.code===200&&(k.value=e.data.data)}catch(l){console.error(l)}},B=async()=>{try{await p.post("/api/admin/student/add",d.value),r(),b()}catch{alert("æ·»åŠ å¤±è´¥")}},D=l=>{l.target.files[0]&&(i.value=[{name:"æµ‹è¯•å­¦ç”Ÿ1",studentId:"20260101",classId:1,parentName:"å®¶é•¿1",parentPhone:"13800000001"},{name:"æµ‹è¯•å­¦ç”Ÿ2",studentId:"20260102",classId:1,parentName:"å®¶é•¿2",parentPhone:"13800000002"},{name:"æµ‹è¯•å­¦ç”Ÿ3",studentId:"20260103",classId:2,parentName:"å®¶é•¿3",parentPhone:"13800000003"}])},F=async()=>{try{const l=await p.post("/api/admin/student/import",{students:i.value});alert(l.data.message),r(),b()}catch{alert("å¯¼å…¥å¤±è´¥")}},q=l=>{x.value=l,C.value=l.classId,M.value=!0},A=async()=>{try{await p.post("/api/admin/student/transfer",{studentId:x.value.id,newClassId:C.value}),r(),b()}catch{alert("è°ƒç­å¤±è´¥")}},E=async l=>{const e=l.status==="banned"?"è§£å°":"å°ç¦";if(confirm(`ç¡®å®šè¦${e} ${l.name} å—ï¼Ÿ`))try{await p.post("/api/admin/student/toggle-ban",{studentId:l.id}),b()}catch{alert("æ“ä½œå¤±è´¥")}},r=()=>{P.value=!1,U.value=!1,M.value=!1,d.value={name:"",studentId:"",classId:"",parentName:"",parentPhone:""},i.value=[],x.value=null};return R(b),(l,e)=>(n(),s("div",K,[t("div",G,[t("div",H,[e[11]||(e[11]=t("h2",{class:"page-title"},"å­¦ç”Ÿåˆ—è¡¨",-1)),t("span",J,"å…± "+o(S.value.length)+" äºº",1)]),t("div",O,[t("button",{class:"secondary-btn",onClick:e[0]||(e[0]=a=>U.value=!0)},[...e[12]||(e[12]=[t("span",null,"ğŸ“¥",-1),_(" Excelå¯¼å…¥ ",-1)])]),t("button",{class:"primary-btn",onClick:e[1]||(e[1]=a=>P.value=!0)},[...e[13]||(e[13]=[t("span",null,"â•",-1),_(" æ–°å¢å­¦ç”Ÿ ",-1)])])])]),t("div",Q,[v(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>m.value=a),type:"text",placeholder:"æœç´¢å§“åã€å­¦å·...",class:"search-input"},null,512),[[y,m.value]]),v(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>I.value=a),class:"filter-select"},[e[14]||(e[14]=t("option",{value:""},"å…¨éƒ¨ç­çº§",-1)),(n(!0),s(h,null,g(k.value,a=>(n(),s("option",{key:a.id,value:a.id},o(a.name),9,W))),128))],512),[[N,I.value]]),v(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>w.value=a),class:"filter-select"},[...e[15]||(e[15]=[t("option",{value:""},"å…¨éƒ¨çŠ¶æ€",-1),t("option",{value:"active"},"æ­£å¸¸",-1),t("option",{value:"banned"},"å·²å°ç¦",-1)])],512),[[N,w.value]])]),t("div",X,[t("table",Y,[e[17]||(e[17]=t("thead",null,[t("tr",null,[t("th",null,"å§“å"),t("th",null,"å­¦å·"),t("th",null,"ç­çº§"),t("th",null,"å®¶é•¿å§“å"),t("th",null,"å®¶é•¿ç”µè¯"),t("th",null,"çŠ¶æ€"),t("th",null,"æœ€åæ´»è·ƒ"),t("th",null,"æ“ä½œ")])],-1)),t("tbody",null,[(n(!0),s(h,null,g($.value,a=>(n(),s("tr",{key:a.id},[t("td",Z,o(a.name),1),t("td",null,o(a.studentId),1),t("td",null,o(a.className),1),t("td",null,o(a.parentName),1),t("td",null,o(a.parentPhone),1),t("td",null,[t("span",{class:T(["status-tag",a.status])},o(a.status==="active"?"æ­£å¸¸":"å·²å°ç¦"),3)]),t("td",null,o(a.lastActive),1),t("td",tt,[t("button",{class:"action-link",onClick:f=>q(a)},"è°ƒç­",8,et),t("button",{class:T(["action-link",a.status==="banned"?"success":"warn"]),onClick:f=>E(a)},o(a.status==="banned"?"è§£å°":"å°ç¦"),11,at)])]))),128)),$.value.length===0?(n(),s("tr",lt,[...e[16]||(e[16]=[t("td",{colspan:"8",class:"empty-row"},"æš‚æ— æ•°æ®",-1)])])):c("",!0)])])]),P.value?(n(),s("div",{key:0,class:"modal-overlay",onClick:V(r,["self"])},[t("div",st,[e[25]||(e[25]=t("h3",{class:"modal-title"},"æ–°å¢å­¦ç”Ÿ",-1)),t("form",{onSubmit:V(B,["prevent"])},[t("div",nt,[t("div",ot,[e[18]||(e[18]=t("label",null,"å§“å *",-1)),v(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>d.value.name=a),type:"text",required:""},null,512),[[y,d.value.name]])]),t("div",dt,[e[19]||(e[19]=t("label",null,"å­¦å· *",-1)),v(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>d.value.studentId=a),type:"text",required:""},null,512),[[y,d.value.studentId]])])]),t("div",ut,[e[21]||(e[21]=t("label",null,"ç­çº§ *",-1)),v(t("select",{"onUpdate:modelValue":e[7]||(e[7]=a=>d.value.classId=a),required:""},[e[20]||(e[20]=t("option",{value:""},"è¯·é€‰æ‹©ç­çº§",-1)),(n(!0),s(h,null,g(k.value,a=>(n(),s("option",{key:a.id,value:a.id},o(a.name),9,it))),128))],512),[[N,d.value.classId]])]),t("div",rt,[t("div",vt,[e[22]||(e[22]=t("label",null,"å®¶é•¿å§“å",-1)),v(t("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>d.value.parentName=a),type:"text"},null,512),[[y,d.value.parentName]])]),t("div",ct,[e[23]||(e[23]=t("label",null,"å®¶é•¿ç”µè¯",-1)),v(t("input",{"onUpdate:modelValue":e[9]||(e[9]=a=>d.value.parentPhone=a),type:"text"},null,512),[[y,d.value.parentPhone]])])]),t("div",{class:"modal-actions"},[t("button",{type:"button",class:"cancel-btn",onClick:r},"å–æ¶ˆ"),e[24]||(e[24]=t("button",{type:"submit",class:"submit-btn"},"æ·»åŠ ",-1))])],32)])])):c("",!0),U.value?(n(),s("div",{key:1,class:"modal-overlay",onClick:V(r,["self"])},[t("div",pt,[e[26]||(e[26]=j('<h3 class="modal-title" data-v-e925bc96>ğŸ“¥ æ‰¹é‡å¯¼å…¥å­¦ç”Ÿ</h3><div class="import-info" data-v-e925bc96><p data-v-e925bc96>è¯·ä¸Šä¼ Excelæ–‡ä»¶ï¼ˆ.xlsxï¼‰ï¼Œæ–‡ä»¶æ ¼å¼ï¼š</p><table class="sample-table" data-v-e925bc96><thead data-v-e925bc96><tr data-v-e925bc96><th data-v-e925bc96>å§“å</th><th data-v-e925bc96>å­¦å·</th><th data-v-e925bc96>ç­çº§ID</th><th data-v-e925bc96>å®¶é•¿å§“å</th><th data-v-e925bc96>å®¶é•¿ç”µè¯</th></tr></thead><tbody data-v-e925bc96><tr data-v-e925bc96><td data-v-e925bc96>å¼ ä¸‰</td><td data-v-e925bc96>20230301</td><td data-v-e925bc96>1</td><td data-v-e925bc96>å¼ çˆ¸çˆ¸</td><td data-v-e925bc96>13800138000</td></tr></tbody></table></div>',2)),t("div",mt,[t("input",{type:"file",accept:".xlsx,.xls",onChange:D},null,32)]),i.value.length>0?(n(),s("div",bt,[t("p",null,"é¢„è§ˆï¼ˆå…± "+o(i.value.length)+" æ¡ï¼‰ï¼š",1),t("div",ft,[(n(!0),s(h,null,g(i.value.slice(0,5),(a,f)=>(n(),s("div",{key:f,class:"preview-item"},o(a.name)+" - "+o(a.studentId),1))),128)),i.value.length>5?(n(),s("div",yt," ...è¿˜æœ‰ "+o(i.value.length-5)+" æ¡ ",1)):c("",!0)])])):c("",!0),t("div",ht,[t("button",{type:"button",class:"cancel-btn",onClick:r},"å–æ¶ˆ"),t("button",{type:"button",class:"submit-btn",disabled:i.value.length===0,onClick:F}," ç¡®è®¤å¯¼å…¥ ",8,gt)])])])):c("",!0),M.value?(n(),s("div",{key:2,class:"modal-overlay",onClick:V(r,["self"])},[t("div",kt,[e[29]||(e[29]=t("h3",{class:"modal-title"},"è°ƒæ•´ç­çº§",-1)),t("p",It,[e[27]||(e[27]=_("å°† ",-1)),t("strong",null,o(x.value?.name),1),e[28]||(e[28]=_(" è°ƒè‡³ï¼š",-1))]),v(t("select",{"onUpdate:modelValue":e[10]||(e[10]=a=>C.value=a),class:"full-select"},[(n(!0),s(h,null,g(k.value,a=>(n(),s("option",{key:a.id,value:a.id},o(a.name),9,wt))),128))],512),[[N,C.value]]),t("div",{class:"modal-actions"},[t("button",{type:"button",class:"cancel-btn",onClick:r},"å–æ¶ˆ"),t("button",{type:"button",class:"submit-btn",onClick:A},"ç¡®è®¤è°ƒç­")])])])):c("",!0)]))}},Vt=L(xt,[["__scopeId","data-v-e925bc96"]]);export{Vt as default};
