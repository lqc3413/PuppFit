import{_ as $,r,i as T,b as o,o as n,e as s,f as h,F as y,k as m,t as c,x as V,g as A,v as B,w as b}from"./index-BgBYIPit.js";import{a as S}from"./index-B9ygI19o.js";const D={class:"grades-page"},E={key:0,class:"loading"},N={key:1,class:"student-list"},F=["onClick"],G={class:"avatar"},I={class:"info"},K={class:"meta"},L={key:0},U={class:"score-badge"},j={class:"val"},q={class:"modal-header"},z={class:"records-container"},H={key:0,class:"empty-text"},J={class:"task-header"},O={class:"task-info"},P={class:"task-title"},Q={class:"task-date"},W={class:"task-score"},X={class:"score-num"},Y={class:"exercise-details"},Z={class:"ex-type"},ss={class:"ex-score-area"},es={key:0,class:"edit-box"},ts=["onClick"],as=["onClick"],os={class:"ex-result"},ns={class:"ex-percent"},cs={__name:"StudentGrades",setup(ls){const f=r([]),g=r(!0),u=r(!1),i=r(null),_=r(null),d=r(0);T(async()=>{await C()});const C=async()=>{try{const l=await S.get("/api/teacher/students");l.data.code===200&&(f.value=l.data.data)}finally{g.value=!1}},w=l=>{i.value=l,u.value=!0},x=()=>{u.value=!1,p()},M=(l,t)=>{_.value=`${l.id}-${t.type}`,d.value=t.score},p=()=>{_.value=null,d.value=0},R=async(l,t)=>{try{const e=await S.post("/api/teacher/update_score",{recordId:l.id,exerciseType:t.type,newScore:d.value});if(e.data.code===200){t.score=d.value,l.totalScore=e.data.data.totalScore;const a=i.value;a.taskRecords&&a.taskRecords.length>0&&(a.avgScore=Math.round(a.taskRecords.reduce((k,v)=>k+v.totalScore,0)/a.taskRecords.length)),p()}}catch{alert("ä¿®æ”¹å¤±è´¥")}};return(l,t)=>(n(),o("div",D,[t[5]||(t[5]=s("header",{class:"section-header"},[s("h2",null,"å­¦ç”Ÿæˆç»©ç®¡ç† ğŸ“Š"),s("p",null,"æŸ¥çœ‹å¹¶ç®¡ç†ç­çº§å­¦ç”Ÿçš„è¿åŠ¨æ•°æ®ï¼ˆæŒ‰ä»»åŠ¡ç»´åº¦ï¼‰")],-1)),g.value?(n(),o("div",E,"åŠ è½½ä¸­...")):(n(),o("div",N,[(n(!0),o(y,null,m(f.value,e=>(n(),o("div",{key:e.id,class:"student-card",onClick:a=>w(e)},[s("div",G,c(e.name[0]),1),s("div",I,[s("h3",null,c(e.name),1),s("p",K,[V(" å·²å®Œæˆ "+c(e.taskRecords?.length||0)+" æ¬¡ä»»åŠ¡ ",1),e.lastActive?(n(),o("span",L," Â· ä¸Šæ¬¡æ´»è·ƒ: "+c(e.lastActive),1)):h("",!0)])]),s("div",U,[t[2]||(t[2]=s("span",{class:"label"},"å¹³å‡åˆ†",-1)),s("span",j,c(e.avgScore||"-"),1)])],8,F))),128))])),u.value?(n(),o("div",{key:2,class:"modal-overlay",onClick:x},[s("div",{class:"modal-content",onClick:t[1]||(t[1]=b(()=>{},["stop"]))},[s("div",q,[s("h3",null,c(i.value.name)+" - ä»»åŠ¡æˆç»©å•",1),s("button",{class:"close-btn",onClick:x},"Ã—")]),s("div",z,[!i.value.taskRecords||i.value.taskRecords.length===0?(n(),o("p",H," æš‚æ— å·²å®Œæˆçš„ä»»åŠ¡ ")):h("",!0),(n(!0),o(y,null,m(i.value.taskRecords,e=>(n(),o("div",{key:e.id,class:"task-record"},[s("div",J,[s("div",O,[s("span",P,c(e.taskTitle),1),s("span",Q,"å®Œæˆäº "+c(e.completedAt),1)]),s("div",W,[s("span",X,c(e.totalScore),1),t[3]||(t[3]=s("span",{class:"score-label"},"åˆ†",-1))])]),s("div",Y,[(n(!0),o(y,null,m(e.results,(a,k)=>(n(),o("div",{key:k,class:"exercise-row"},[s("span",Z,c(a.type),1),s("div",ss,[_.value===`${e.id}-${a.type}`?(n(),o("div",es,[A(s("input",{type:"number","onUpdate:modelValue":t[0]||(t[0]=v=>d.value=v),class:"score-input"},null,512),[[B,d.value,void 0,{number:!0}]]),s("button",{class:"save-btn",onClick:v=>R(e,a)},"ğŸ’¾",8,ts),s("button",{class:"cancel-btn",onClick:p},"âŒ")])):(n(),o("div",{key:1,class:"view-box",onClick:b(v=>M(e,a),["stop"])},[s("span",os,c(a.score)+" / "+c(a.target),1),s("span",ns,c(Math.min(100,Math.round(a.score/a.target*100)))+"åˆ†",1),t[4]||(t[4]=s("span",{class:"edit-icon"},"âœï¸",-1))],8,as))])]))),128))])]))),128))])])])):h("",!0)]))}},rs=$(cs,[["__scopeId","data-v-366f0970"]]);export{rs as default};
