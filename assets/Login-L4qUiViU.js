import{d as w,r as c,c as v,_ as I,a as k,b as m,e as s,n as g,w as h,f as x,g as f,v as b,t as S,u as N,o as _}from"./index-jU6pvMoE.js";import{a as L}from"./index-B9ygI19o.js";const C=w("user",()=>{const i=c(localStorage.getItem("token")||""),t=c(JSON.parse(localStorage.getItem("user")||"{}")),d=v(()=>!!i.value),r=v(()=>t.value.role||""),u=v(()=>t.value.name||"");function n(o,e){i.value=e,t.value=o,localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify(o))}function l(){i.value="",t.value={},localStorage.removeItem("token"),localStorage.removeItem("user")}function p(o){t.value={...t.value,...o},localStorage.setItem("user",JSON.stringify(t.value))}return{token:i,userInfo:t,isLoggedIn:d,userRole:r,userName:u,login:n,logout:l,updateUserInfo:p}}),U={class:"login-wrapper"},V={class:"login-box"},B={class:"tabs"},J={class:"form-group"},M={class:"form-group"},O=["disabled"],q={key:0,class:"error-msg"},R={__name:"Login",setup(i){const t=N(),d=C(),r=c("parent"),u=c(!1),n=c(""),l=k({username:"",password:""}),p=async()=>{u.value=!0,n.value="";try{const o=await L.post("/api/auth/login",{username:l.username,password:l.password,type:r.value}),{code:e,data:a,message:y}=o.data;e===200?(console.log("Login Success:",a),d.login(a.user,a.token),t.push("/dashboard")):n.value=y}catch(o){n.value="登录请求失败，请检查网络",console.error(o)}finally{u.value=!1}};return(o,e)=>(_(),m("div",U,[s("div",V,[e[6]||(e[6]=s("div",{class:"header"},[s("h1",{class:"title"},"PuppyFit 家校互联"),s("p",{class:"subtitle"},"连接家庭与校园，共筑健康未来")],-1)),s("div",B,[s("button",{class:g(["tab-btn",{active:r.value==="parent"}]),onClick:e[0]||(e[0]=a=>r.value="parent")}," 我是家长 ",2),s("button",{class:g(["tab-btn",{active:r.value==="teacher"}]),onClick:e[1]||(e[1]=a=>r.value="teacher")}," 我是老师 ",2)]),s("form",{onSubmit:h(p,["prevent"]),class:"login-form"},[s("div",J,[e[4]||(e[4]=s("label",null,"账号",-1)),f(s("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>l.username=a),type:"text",placeholder:"请输入账号",required:""},null,512),[[b,l.username]])]),s("div",M,[e[5]||(e[5]=s("label",null,"密码",-1)),f(s("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>l.password=a),type:"password",placeholder:"请输入密码",required:""},null,512),[[b,l.password]])]),s("button",{type:"submit",class:"submit-btn",disabled:u.value},S(u.value?"登录中...":"立即登录"),9,O),n.value?(_(),m("p",q,S(n.value),1)):x("",!0)],32)])]))}},D=I(R,[["__scopeId","data-v-cccf9f7c"]]);export{D as default};
