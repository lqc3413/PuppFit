import{_ as B,r as h,c as y,i as F,b as l,o,e,g as c,v as k,z as _,F as v,k as p,t as i,f as I,n as C}from"./index-BgBYIPit.js";import{a as b}from"./index-B9ygI19o.js";const z={class:"task-assign-page"},A={class:"form-card"},P={class:"form-group"},j={class:"form-group"},L={class:"date-selects"},O=["value"],W=["value"],q=["value"],G={class:"exercises-section"},H=["onUpdate:modelValue","onChange"],J=["value"],K={class:"input-with-unit"},Q=["onUpdate:modelValue"],R={class:"unit-label"},X={class:"input-with-unit weight-input"},Y=["onUpdate:modelValue"],Z=["onClick"],ee={class:"form-actions"},te=["disabled"],se={class:"pending-section"},ae={class:"students-grid"},ne={class:"student-header"},le={class:"student-avatar"},oe={class:"student-info"},ie={class:"student-class"},re={key:0,class:"pending-list"},de={class:"task-content"},ue={class:"task-title"},ce={class:"task-meta"},ve={key:1,class:"no-pending"},pe={__name:"TaskAssign",setup(me){const f=h([]),d=y(()=>f.value.filter(a=>a.status==="active")),n=h({title:"",year:2026,month:1,day:20,exercises:[]}),g=h(!1),x=h([]),V=async()=>{try{const a=await b.get("/api/admin/exercise-types");if(a.data.code===200&&(f.value=a.data.data,d.value.length>0)){const s=d.value[0];n.value.exercises=[{type:s.name,target:50,weight:.5},{type:d.value[1]?.name||s.name,target:100,weight:.5}]}}catch(a){console.error("è·å–è¿åŠ¨é¡¹ç›®å¤±è´¥:",a)}},w=a=>{const s=f.value.find(t=>t.name===a);return s?s.unit:"ä¸ª"},U=a=>{},T=async()=>{try{const a=await b.get("/api/teacher/pending_tasks");a.data.code===200&&(x.value=a.data.data)}catch(a){console.error("è·å–å¾…åŠä»»åŠ¡å¤±è´¥:",a)}};F(()=>{V(),T()});const E=[2025,2026,2027,2028,2029,2030],S=y(()=>{const a=n.value.year,s=n.value.month;return new Date(a,s,0).getDate()}),D=y(()=>{const a=n.value.year,s=String(n.value.month).padStart(2,"0"),t=String(n.value.day).padStart(2,"0");return`${a}-${s}-${t}`}),m=y(()=>n.value.exercises.reduce((a,s)=>a+(s.weight||0),0)),$=()=>{const a=d.value[0]?.name||"è·³ç»³";n.value.exercises.push({type:a,target:30,weight:0})},M=a=>{n.value.exercises.splice(a,1)},N=async()=>{if(!n.value.title){alert("è¯·å¡«å†™ä»»åŠ¡æ ‡é¢˜");return}if(n.value.exercises.length===0){alert("è¯·è‡³å°‘æ·»åŠ ä¸€é¡¹è¿åŠ¨");return}if(m.value!==1){alert("æ‰€æœ‰è¿åŠ¨çš„æƒé‡æ€»å’Œå¿…é¡»ç­‰äº 1.0");return}g.value=!0;try{const a=n.value.exercises.map(t=>({type:t.type,target:t.target,unit:w(t.type),weight:t.weight}));if((await b.post("/api/teacher/publish_task",{title:n.value.title,deadline:D.value,exercises:a})).data.code===200){alert("ä»»åŠ¡å‘å¸ƒæˆåŠŸï¼"),await T();const t=d.value[0];n.value={title:"",year:2026,month:1,day:20,exercises:[{type:t?.name||"è·³ç»³",target:50,weight:.5},{type:d.value[1]?.name||t?.name||"è·³ç»³",target:100,weight:.5}]}}}catch(a){console.error(a),alert("å‘å¸ƒå¤±è´¥")}finally{g.value=!1}};return(a,s)=>(o(),l("div",z,[s[12]||(s[12]=e("header",{class:"section-header"},[e("h2",null,"å‘å¸ƒæ–°ä»»åŠ¡ ğŸ“"),e("p",null,"ä¸ºç­çº§åŒå­¦å¸ƒç½®æ–°çš„è¿åŠ¨æŒ‘æˆ˜ï¼ˆå¯åŒ…å«å¤šé¡¹è¿åŠ¨ï¼‰")],-1)),e("div",A,[e("div",P,[s[4]||(s[4]=e("label",null,"ä»»åŠ¡æ ‡é¢˜",-1)),c(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>n.value.title=t),type:"text",placeholder:"ä¾‹å¦‚ï¼šç¬¬ä¸€å‘¨ä½“èƒ½æµ‹è¯•"},null,512),[[k,n.value.title]])]),e("div",j,[s[5]||(s[5]=e("label",null,"æˆªæ­¢æ—¥æœŸ",-1)),e("div",L,[c(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>n.value.year=t)},[(o(),l(v,null,p(E,t=>e("option",{key:t,value:t},i(t)+"å¹´",9,O)),64))],512),[[_,n.value.year]]),c(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>n.value.month=t)},[(o(),l(v,null,p(12,t=>e("option",{key:t,value:t},i(t)+"æœˆ",9,W)),64))],512),[[_,n.value.month]]),c(e("select",{"onUpdate:modelValue":s[3]||(s[3]=t=>n.value.day=t)},[(o(!0),l(v,null,p(S.value,t=>(o(),l("option",{key:t,value:t},i(t)+"æ—¥",9,q))),128))],512),[[_,n.value.day]])])]),e("div",G,[e("div",{class:"exercises-header"},[s[6]||(s[6]=e("label",null,"è¿åŠ¨é¡¹ç›®",-1)),e("button",{class:"btn-add",onClick:$},"+ æ·»åŠ è¿åŠ¨")]),(o(!0),l(v,null,p(n.value.exercises,(t,u)=>(o(),l("div",{key:u,class:"exercise-row"},[c(e("select",{"onUpdate:modelValue":r=>t.type=r,onChange:r=>U()},[(o(!0),l(v,null,p(d.value,r=>(o(),l("option",{key:r.id,value:r.name},i(r.name),9,J))),128))],40,H),[[_,t.type]]),e("div",K,[c(e("input",{"onUpdate:modelValue":r=>t.target=r,type:"number",placeholder:"ç›®æ ‡"},null,8,Q),[[k,t.target,void 0,{number:!0}]]),e("span",R,i(w(t.type)),1)]),e("div",X,[c(e("input",{"onUpdate:modelValue":r=>t.weight=r,type:"number",step:"0.1",min:"0",max:"1",placeholder:"æƒé‡"},null,8,Y),[[k,t.weight,void 0,{number:!0}]]),s[7]||(s[7]=e("span",{class:"unit-label"},"æƒé‡",-1))]),n.value.exercises.length>1?(o(),l("button",{key:0,class:"btn-remove",onClick:r=>M(u)},"Ã—",8,Z)):I("",!0)]))),128)),e("div",{class:C(["weight-hint",{error:m.value!==1}])}," æƒé‡æ€»å’Œ: "+i(m.value.toFixed(1))+" "+i(m.value===1?"âœ“":"(éœ€è¦ç­‰äº 1.0)"),3)]),s[8]||(s[8]=e("div",{class:"form-group"},[e("label",null,"åˆ†é…å¯¹è±¡"),e("select",{disabled:""},[e("option",null,"ä¸‰å¹´çº§äºŒç­ (å…¨ä½“)")])],-1)),e("div",ee,[e("button",{class:"btn-submit",onClick:N,disabled:g.value||m.value!==1},i(g.value?"å‘å¸ƒä¸­...":"ç¡®è®¤å‘å¸ƒ"),9,te)])]),e("div",se,[s[11]||(s[11]=e("header",{class:"section-header"},[e("h2",null,"å­¦ç”Ÿå¾…åŠä»»åŠ¡ ğŸ“"),e("p",null,"æŸ¥çœ‹æ¯ä½å­¦ç”Ÿçš„æœªå®Œæˆä»»åŠ¡")],-1)),e("div",ae,[(o(!0),l(v,null,p(x.value,t=>(o(),l("div",{key:t.studentId,class:"student-card"},[e("div",ne,[e("div",le,i(t.studentName[0]),1),e("div",oe,[e("h4",null,i(t.studentName),1),e("span",ie,i(t.class),1)]),e("div",{class:C(["pending-badge",{warning:t.pendingCount>0}])},i(t.pendingCount)+" å¾…åŠ ",3)]),t.pendingTasks.length>0?(o(),l("div",re,[(o(!0),l(v,null,p(t.pendingTasks,u=>(o(),l("div",{key:u.id,class:"pending-item"},[s[9]||(s[9]=e("div",{class:"task-icon"},"ğŸ”¥",-1)),e("div",de,[e("span",ue,i(u.title),1),e("span",ce,i(u.exerciseCount)+" é¡¹è¿åŠ¨ Â· æˆªæ­¢ "+i(u.deadline),1)])]))),128))])):(o(),l("div",ve,[...s[10]||(s[10]=[e("span",{class:"emoji"},"ğŸ‰",-1),e("span",null,"å¤ªæ£’äº†ï¼æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆ",-1)])]))]))),128))])])]))}},ye=B(pe,[["__scopeId","data-v-f46f601b"]]);export{ye as default};
