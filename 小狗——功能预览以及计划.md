成员：终端(小狗)：slt，zxh
	后端：cbyj
	前端：lqc
### 功能点
- 仰卧起坐计数【已完成】
	- mediapipe实现姿态识别（动作/状态判断），与仰卧起坐计数
- 语音交互
	- 语音触发事件
		- 例如
			- “开始计数”——倒数三秒后进行计数
			- 小狗播报成绩：一分钟仰卧起坐结束后，播报成绩（可以加上人脸识别，播报xxx，成绩为30个，然后将学生成绩数据传入数据库）
	- 语音联动视觉(后面可以加)
		- 自动进行录像+人脸识别，将录像数据保存至后端服务器，录像自动命名为 班级_姓名_仰卧起坐个数
- 位置判断（目标跟踪）【电脑上已完成，未落地至机器狗】
	- slam实现姿态估计（具体到角度和坐标）【打算这么干，还未实施】
- 未完待续。。。

### 硬件模块（终端）
实现仰卧起坐计数-->语音模块实现用户交互-->目标追踪,位置判断

### 前端（用户端）
教师端发布运动任务-->学生完成认任务-->老师获取学生数据
- 仰卧起坐学生成绩记录
	- 学生端
		- 账号登录，查看自己的成绩
			- 列表查看第x次测试成绩
	- 教师端
		- 发布运动任务
		- 查看学生运动视频（新增，等三端联调好以后再加），成绩，以及修改错误数据，错误数据上报至日志
			- 教师端可以修改成绩，日志上报xxx老师修改了xxx（学生）的成绩，记录修改前和修改后的成绩
		- 查看所有学生的运动成绩
		- 实时监控学生运动情况(新增)
	- 管理员端（开发者端）
		- 查看上传日志，分析数据（误报率等，方便开发者对于模型进行调整）
		- 管理和注册学生账户和教师账户
### 远端
- 后端
	- API、业务逻辑、工作流引擎入口
- 工作流模块 `workflow_engine`
	-  建模流程编排、重试/失败处理、状态推进
- 数据管理 ​data_manager​
	- SQLite 业务数据存储与索引

```
backend/
├── api/                # 对外接口层（按角色）
│   ├── student_api.py(学生端接口，查看自己的成绩、单次测试详情)
│   ├── teacher_api.py(教师端接口，发布运动任务、查看学生成绩、修改成绩)
│   ├── admin_api.py(管理员接口，用户管理、查看日志、误报率分析)
│   └── auth_api.py(统一认证入口) 
│
├── service/            # 业务服务层（核心逻辑）
│   ├── task_service.py(运动任务服务；创建任务、下发任务、查询任务状态)
│   ├── workout_service.py(学生运动记录服务；创建运动记录、更新计数结果、关联视频路径（待定）)
│   ├── review_service.py(成绩审核与修改服务；教师修改成绩，保留原始数据，写修改日志)
│   ├── monitor_service.py(实时监控服务（可选）)
│   └── user_service.py(创建账户，查询用户信息，校验角色权限)
│
├── workflow_engine/    # 运动工作流(管理“开始->计数->停止”的全过程)
|	├──状态机
|	├──定时器	
|	└──超时判断
|	
├── data_manager/       # 数据存储(所有数据库操作的同一入口)
|	├──SQLite CRUD
|	├──表结构封装
|	└──索引管理
|
├── mqtt_bridge/        # 硬件通信
|	├──发布控制指令
|	├──订阅硬件状态
|	└──解析消息
|
├── log_manager/        # 审计 & 修改日志
|	├──成绩修改日志
|	├──异常日志
|	└──操作日志	
|		   
└── model_analysis/     # 管理员分析模块
	├──统计误报率
	├──分析修改频率
	└──输出分析结果
```
- 语义理解与对话 `semantic_engine`
	- Intent、上下文管理、任务型对话、非任务型问答
- 指令生成与 Function Call ​dialog_function_engine​
	-  Function Call 决策、参数抽取、多步拆解、标准化指令输出
- 语音业务编排 ​voice_workflow​
	- 语音记录逻辑、与任务/定位联动

三端联调
```
┌──────────┐        HTTP / WS        ┌────────────┐
│  前端     │  ───────────────────▶   │   后端     │
│ 学生/教师 │  ◀───────────────────    │   FastAPI │
└──────────┘        JSON 数据         └─────▲──────┘
										   │
										   │ MQTT
										   │
									  ┌───────┴───────┐
									  │   终端小狗     │
									  │ PuppyPi       │
									  │ 摄像头/语音/AI │
									  └───────────────┘

```

- 对于终端侧需要回传的大文件/录制数据，采用“通知 + 文件传输 + 回执”的流程：
	1. 终端通过 MQTT 向远端发送“数据就绪/请求处理”消息，并挂起对应任务频道
	2. 远端接收后启动工作流：
	3. 使用 SFTP/SSH 拉取数据包
	4. 执行建模/后处理
	5. 生成结果并通过 SFTP/SSH 回传
	6. 远端通过 MQTT 发布“处理完成/失败”状态（含结果版本、索引信息）
	7. 终端恢复频道并加载结果（必要时更新本地地图元数据）

### 计划

#### 阶段一：即日起 – 2025.1.31

| 模块  | 具体任务            | 实现要求                                   | 负责人 |
| --- | --------------- | -------------------------------------- | --- |
| 终端  | 仰卧起坐计数          | ✔ MediaPipe 姿态识别 + 稳定计数<br>✔ 本地打印/日志输出 | 硬件组 |
| 终端  | 语音触发事件          | ✔ 语音“开始计数”<br>✔ 语音驱动流程                 | 硬件组 |
| 终端  | 基础语音播报          | ✔ 固定语音：倒计时 + 结束播报<br>✘ 不做复杂对话          | 硬件组 |
| 终端  | 摄像头采集           | ✔ 能采集视频<br>✔ 本地保存                      | 硬件组 |
| 后端  | 项目骨架搭建          | ✔ FastAPI/Flask 启动<br>✔ 目录结构搭好         | 后端  |
| 后端  | SQLite 数据库      | ✔ 用户表 / 成绩表<br>✔ 本地可查询                 | 后端  |
| 后端  | workout_service | ✔ 接收计数结果<br>✔ 写入数据库                    | 后端  |
| 后端  | task_service    | ✔ 教师发布任务                               | 后端  |
| 前端  | 页面原型            | ✔ 教师端 / 学生端原型图或 Demo                   | 前端  |
| 前端  | 成绩展示            | ✔ 学生可看到自己的成绩列表                         | 前端  |
| 联调  | 终端 → 后端         | ✔  MQTT<br>✔ 数据能入库                     | 全体  |
#### 阶段二：2025.2.1 – 2025.3.1

| 模块   | 具体任务            | 实现要求                      | 负责人 |
| ---- | --------------- | ------------------------- | --- |
| 终端   | 语音+视觉联动         | ✔ 自动录像<br>✔ 命名：班级\_姓名\_次数 | 硬件组 |
| 终端   | 目标追踪            | ✔ 将已完成的 PC 版逻辑移植到机器狗      | 硬件组 |
| 终端   | SLAM 融合         | ✔ 位姿/角度估计<br>✔ 为跟踪提供坐标    | 硬件组 |
| 后端   | workflow_engine | ✔ 状态机<br>✔ 1分钟/持续模式       | 后端  |
| 后端   | MQTT 通信         | ✔ 控制指令<br>✔ 状态上报          | 后端  |
| 后端   | review_service  | ✔ 教师修改成绩<br>✔ 原始数据保留      | 后端  |
| 后端   | log_manager     | ✔ 修改日志<br>✔ 操作审计          | 后端  |
| 前端   | 教师实时监控          | ✔ 实时查看学生状态                | 前端  |
| 前端   | 视频回放            | ✔ 播放运动视频                  | 前端  |
| 管理员端 | 数据分析            | ✔ 误报率统计<br>✔ 修改频率分析       | 后端  |
| 三端联调 | 全系统联调           | ✔ 硬件 + 后端 + 前端完整闭环        | 全体  |
